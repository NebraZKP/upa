# UPA contracts, client SDK and tools

UPA is Nebra's "Universal Proof Aggregator".  This package contains the client
SDK for buiding apps that leverage the UPA to reduce the cost of on-chain ZKP
verification.

This package also includes the `upa` tool for interacting with UPA
deployments.

Full documentation is available at docs.nebra.one.

[RELEASE NOTES](#release-notes)

## Requirements

- node.js>=18

## Installation

```console
$ yarn add @nebrazkp/upa
```

Run the `upa` tool
```console
$ ./node_modules/bin/upa --help
```

### Development

See [DEVELOPMENT.md].

## Release notes

### V1.2.x

The `Proof` and `VerifyingKey` objects, representing Groth16 proofs and keys
created by applications, have been renamed to `Groth16Proof` and
`Groth16VerifyingKey`, to avoid ambiguity and make room for future features.

The `upa deploy` command now takes in a `upa_config.json` file. To use a
test configuration instead, pass the flag `--use-test-config`.

CircuitIDs are now of type `bytes32` instead of `uint256`, requiring
application contracts to be updated accordingly.  Support to compute it
off-chain has been added to the SDK.  (The `computeCircuitId` has been removed
from `UpaClient` and is now available as a standalone function in the
`sdk.utils` module.)

`ProofVerified` events are no longer emitted. Instead, `SubmissionVerified`
events are emitted.

### V1.1.2

Added the `upa` tool command `upa convert-proof-snarkjs`.

### V1.1.1

The `upa` tool in the SDK has been extended to include `convert-vk-gnark` and
`convert-proof-gnark` commands.  Groth16 proofs with accompanying commitments
to witness data (including those generated by the Gnark library) are now
supported by the aggregation pipeline.  Note that support is limited to single
commitments to non-public data, using Keccak as the hash in the
`hash-to-field` function.

NOTE: This version of the SDK is accompanied by a new testnet deployment, and
does not maintain compatibility with the v1.0.x releases.

See docs.nebra.one for further details.

### v1.0.1

- `upa groth16-verify` tool for offline proof and input data verification
- Expose `VerifyingKey` in top-level namespace
- Documentation comments for more public types and functions

### v1.0.0

This version of the package provides:

- A Typescript library including full support for client-side proof submission
  and detection of aggregation.
- Solidity contract interfaces and library for on-chain verification from
  application smart contracts.
- A `upa` CLI tools for performing operations on a deployed instance, as well
  as for setting up development environments for end-to-end application testing.

NOTE: The SDK defines types `application.Proof` and `application.VerifyingKey`
for Groth16 verifying keys and proofs, describing the format expected for
these objects.  Functions to convert from keys and proofs as output from
`snarkjs` and `gnark` are also included.  Proofs generated by other implementations
(arkworks, etc) must be converted to the `application` types by the
caller (see the definitions of these types in `application.d.ts` for details).

Conversion function for more Groth16 implementations will be provided in
upcoming versions.
